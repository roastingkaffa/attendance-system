# 禾一考勤系統 - 後台管理手冊

## 目錄
1. [系統概述](#系統概述)
2. [登入後台](#登入後台)
3. [員工管理](#員工管理)
4. [公司管理](#公司管理)
5. [部門管理](#部門管理)
6. [員工與公司關係](#員工與公司關係)
7. [工時設定](#工時設定)
8. [主管關係設定](#主管關係設定)
9. [審批政策設定](#審批政策設定)
10. [假別額度管理](#假別額度管理)
11. [出勤記錄管理](#出勤記錄管理)
12. [請假記錄管理](#請假記錄管理)
13. [加班記錄管理](#加班記錄管理)
14. [補打卡管理](#補打卡管理)
15. [審批記錄管理](#審批記錄管理)
16. [通知管理](#通知管理)
17. [資料匯出](#資料匯出)
18. [常見操作](#常見操作)

---

## 系統概述

Django Admin 後台提供系統管理員完整的資料管理功能，包含：
- 員工、公司、部門的 CRUD 操作
- 出勤、請假、加班記錄的查詢與管理
- 審批流程的設定與監控
- 資料匯出功能

### 後台網址
```
http://localhost:8000/admin/
```

### 登入帳號
| 角色 | 帳號 | 說明 |
|------|------|------|
| 超級管理員 | CEO001 | 具備所有權限 |
| HR 管理員 | HR001 | 員工與考勤管理 |

---

## 登入後台

### 登入步驟
1. 開啟後台網址
2. 輸入帳號（員工編號）
3. 輸入密碼
4. 點擊「登入」

### 權限說明
- **超級使用者 (is_superuser)**：可存取所有功能
- **工作人員 (is_staff)**：可登入後台但受權限限制
- 一般員工無法登入後台

---

## 員工管理

### 路徑
`首頁 > Attendance > 員工`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| 員工編號 | 唯一識別碼（如 EMP001）|
| 使用者名稱 | 員工姓名 |
| 角色 | employee/manager/hr_admin/ceo |
| 部門 | 所屬部門 |
| 電話 | 聯絡電話 |
| 啟用狀態 | 帳號是否有效 |

### 新增員工
1. 點擊右上角「新增 員工」
2. 填寫基本資訊：
   - **員工編號**：格式如 EMP001、MGR001、HR001
   - **使用者名稱**：員工姓名
   - **Email**：電子郵件
   - **電話**：聯絡電話
3. 設定角色與部門：
   - **角色**：選擇員工類型
   - **部門**：選擇所屬部門
4. 設定帳戶狀態：
   - **is_active**：帳號是否啟用
   - **is_staff**：是否可登入後台
   - **is_superuser**：是否為超級管理員
5. 點擊「儲存」

### 角色類型
| 角色 | 代碼 | 說明 |
|------|------|------|
| 一般員工 | employee | 基本打卡與申請功能 |
| 部門主管 | manager | 可審批下屬申請 |
| HR 管理員 | hr_admin | 員工管理權限 |
| 總經理 | ceo | 全公司權限 |
| 系統管理員 | system_admin | 系統設定權限 |

### 篩選與搜尋
- **篩選**：角色、部門、啟用狀態
- **搜尋**：員工編號、使用者名稱、Email

---

## 公司管理

### 路徑
`首頁 > Attendance > 公司`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 公司編號 |
| 公司名稱 | 公司全名 |
| 公司地址 | 實體地址 |
| 公司位置緯度 | GPS 緯度 |
| 公司位置經度 | GPS 經度 |
| GPS合法範圍半徑 | 打卡有效範圍（公尺）|
| QR Code | 下載打卡用 QR Code |

### 新增公司
1. 點擊「新增 公司」
2. 填寫公司資訊：
   - **公司名稱**：公司全名
   - **公司地址**：實體地址
   - **緯度/經度**：使用 Google Maps 取得精確座標
   - **範圍半徑**：建議設定 50-200 公尺
3. 點擊「儲存」

### 下載 QR Code
1. 在公司列表中找到目標公司
2. 點擊「📥 下載 QR Code」按鈕
3. 系統自動產生並下載 PNG 圖檔
4. 將 QR Code 列印並張貼於公司入口處

### QR Code 內容
```json
{
  "type": "attendance_clock",
  "company_id": 1,
  "company_name": "禾一系統有限公司",
  "latitude": 24.938567,
  "longitude": 121.255368,
  "radius": 100.0
}
```

---

## 部門管理

### 路徑
`首頁 > Attendance > 部門`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 部門編號 |
| 名稱 | 部門名稱 |
| 公司 | 所屬公司 |
| 部門主管 | 主管姓名 |
| 上級部門 | 組織階層 |
| 員工數 | 部門人數 |
| 啟用狀態 | 是否有效 |

### 新增部門
1. 點擊「新增 部門」
2. 填寫基本資訊：
   - **名稱**：部門名稱
   - **公司**：選擇所屬公司
   - **描述**：部門說明（選填）
3. 設定組織架構：
   - **部門主管**：選擇主管員工
   - **上級部門**：選擇父部門（若有）
4. 點擊「儲存」

---

## 員工與公司關係

### 路徑
`首頁 > Attendance > 員工與公司關係`

### 說明
此表格定義員工與公司的僱傭關係，支援：
- 一個員工可屬於多家公司
- 記錄入職/離職日期
- 指派直屬主管
- 設定員工班表

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 關聯編號 |
| 員工編號 | 員工 ID |
| 員工姓名 | 員工名稱 |
| 公司編號 | 公司 ID |
| 公司名稱 | 公司名稱 |
| 直屬主管 | 指派的主管 |
| 在職狀態 | 是否在職 |
| 入職日期 | 到職日 |
| 離職日期 | 離職日（若有）|

### 新增員工公司關係
1. 點擊「新增」
2. 選擇員工與公司
3. 設定：
   - **在職狀態**：勾選表示在職
   - **入職日期**：選擇日期
   - **直屬主管**：選擇主管
   - **員工班表**：選擇適用的工時設定
4. 點擊「儲存」

---

## 工時設定

### 路徑
`首頁 > Attendance > 工時設定`

### 說明
定義公司的上下班時間與相關規則，用於判定遲到/早退。

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 設定編號 |
| 公司 | 適用公司 |
| 班表名稱 | 如「正常班」「早班」|
| 上班時間 | 標準上班時間 |
| 下班時間 | 標準下班時間 |
| 標準工時 | 每日應工作時數 |
| 遲到寬限 | 遲到寬限分鐘數 |
| 預設 | 是否為公司預設班表 |
| 啟用 | 是否有效 |

### 新增班表
1. 點擊「新增 工時設定」
2. 設定基本資訊：
   - **公司**：選擇適用公司
   - **班表名稱**：如「正常班」
   - **預設**：勾選表示為公司預設班表
3. 設定工時：
   - **上班時間**：如 09:00
   - **下班時間**：如 18:00
   - **標準工時**：如 8 小時
   - **午休時間**：如 60 分鐘
4. 設定遲到寬限：
   - **遲到寬限分鐘**：如 15 分鐘（09:15 前打卡不算遲到）
5. 點擊「儲存」

---

## 主管關係設定

### 路徑
`首頁 > Attendance > 主管關係`

### 說明
定義員工與主管的關係，用於審批流程的主管自動判定。

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 關係編號 |
| 員工 | 下屬員工 |
| 主管 | 直屬主管 |
| 公司 | 適用公司 |
| 生效日期 | 關係開始日 |
| 結束日期 | 關係結束日（選填）|

### 新增主管關係
1. 點擊「新增」
2. 選擇：
   - **員工**：選擇下屬
   - **主管**：選擇直屬主管
   - **公司**：適用的公司
   - **生效日期**：關係開始日期
3. 點擊「儲存」

> **注意**：儲存時會自動同步更新「員工與公司關係」中的直屬主管欄位。

---

## 審批政策設定

### 路徑
`首頁 > Attendance > 審批政策`

### 說明
定義不同請假天數的審批層級，支援多層審批。

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 政策編號 |
| 政策名稱 | 如「一般請假」|
| 公司 | 適用公司 |
| 最小天數 | 適用的最小請假天數 |
| 最大天數 | 適用的最大請假天數 |
| 啟用 | 是否有效 |

### 新增審批政策
1. 點擊「新增」
2. 設定基本資訊：
   - **政策名稱**：如「短假審批」
   - **公司**：選擇適用公司
3. 設定天數範圍：
   - **最小天數**：如 0
   - **最大天數**：如 3
4. 設定審批層級（JSON 格式）：
```json
[
  {"level": 1, "role": "manager", "description": "直屬主管"},
  {"level": 2, "role": "hr", "description": "人資部門"}
]
```
5. 點擊「儲存」

### 審批角色說明
| role | 說明 |
|------|------|
| manager | 直屬主管（系統自動取得）|
| hr | 人資部門（員工編號以 HR 開頭）|
| ceo | 總經理（員工編號以 CEO 開頭）|

---

## 假別額度管理

### 路徑
`首頁 > Attendance > 假別額度`

### 說明
管理員工各年度的假別額度。

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 額度編號 |
| 員工 | 員工姓名 |
| 年度 | 適用年度 |
| 假別 | 假別類型 |
| 總時數 | 年度總額度 |
| 已使用 | 已使用時數 |
| 剩餘 | 可用時數 |

### 新增/調整額度
1. 點擊「新增」或選擇既有記錄
2. 設定：
   - **員工**：選擇員工
   - **年度**：如 2026
   - **假別**：選擇假別類型
   - **總時數**：設定年度總額度
3. 點擊「儲存」

### 假別類型代碼
| 代碼 | 假別 |
|------|------|
| annual | 特休 |
| sick | 病假 |
| personal | 事假 |
| official | 公假 |
| marriage | 婚假 |
| funeral | 喪假 |
| compensatory | 補休 |

---

## 出勤記錄管理

### 路徑
`首頁 > Attendance > 出缺勤紀錄`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| 關聯編號 | 員工公司關係 ID |
| 員工編號 | 員工 ID |
| 員工姓名 | 員工名稱 |
| 公司名稱 | 所屬公司 |
| 日期 | 出勤日期 |
| 簽到時間 | 上班打卡時間 |
| 簽退時間 | 下班打卡時間 |
| 簽到地點 | GPS 座標 |
| 簽退地點 | GPS 座標 |
| 工作時數 | 實際工作時數 |

### 搜尋功能
- 依員工編號搜尋
- 依員工姓名搜尋

### 匯出功能
1. 勾選要匯出的記錄（或全選）
2. 選擇動作「匯出出缺勤與請假紀錄」
3. 點擊「去」
4. 選擇日期範圍
5. 點擊「Apply」下載 Excel

---

## 請假記錄管理

### 路徑
`首頁 > Attendance > 請假紀錄`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| 關聯編號 | 員工公司關係 ID |
| 員工編號 | 員工 ID |
| 員工姓名 | 員工名稱 |
| 公司名稱 | 所屬公司 |
| 開始時間 | 請假開始 |
| 結束時間 | 請假結束 |
| 請假時數 | 總時數 |
| 請假原因 | 事由 |

### 匯出功能
1. 選擇動作「匯出指定日期範圍的資料」
2. 設定日期範圍
3. 下載 Excel

---

## 加班記錄管理

### 路徑
`首頁 > Attendance > 加班記錄`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 記錄編號 |
| 員工 | 申請人 |
| 日期 | 加班日期 |
| 開始時間 | 加班開始 |
| 結束時間 | 加班結束 |
| 加班時數 | 總時數 |
| 補償方式 | 加班費/補休 |
| 狀態 | pending/approved/rejected |

### 狀態說明
| 狀態 | 說明 |
|------|------|
| pending | 待審批 |
| approved | 已核准 |
| rejected | 已駁回 |

---

## 補打卡管理

### 補打卡申請
`首頁 > Attendance > 補打卡申請`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 申請編號 |
| 申請人 | 員工姓名 |
| 日期 | 補打卡日期 |
| 類型 | checkin/checkout/both |
| 狀態 | pending/approved/rejected |
| 原因 | 申請事由 |

### 補打卡額度
`首頁 > Attendance > 補打卡額度`

管理員工年度補打卡次數限制。

---

## 審批記錄管理

### 路徑
`首頁 > Attendance > 審批記錄`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 審批編號 |
| 請假單 | 關聯的請假記錄 |
| 審批人 | 審批者 |
| 審批層級 | 第幾層審批 |
| 狀態 | pending/approved/rejected |
| 建立時間 | 審批建立時間 |
| 審批時間 | 實際審批時間 |

### 手動審批
1. 點擊審批記錄進入編輯頁面
2. 修改狀態為「approved」或「rejected」
3. 點擊「儲存」

> **注意**：儲存時會自動同步更新請假記錄狀態並扣除額度。

---

## 通知管理

### 路徑
`首頁 > Attendance > 通知記錄`

### 列表欄位
| 欄位 | 說明 |
|------|------|
| ID | 通知編號 |
| 接收人 | 通知對象 |
| 類型 | approval/system/reminder |
| 標題 | 通知標題 |
| 已讀 | 是否已讀 |
| 建立時間 | 發送時間 |

### 通知類型
| 類型 | 說明 |
|------|------|
| approval | 審批相關通知 |
| system | 系統公告 |
| reminder | 提醒通知 |

---

## 資料匯出

### 出勤與請假匯出
1. 進入「出缺勤紀錄」
2. 勾選記錄或全選
3. 選擇動作「匯出出缺勤與請假紀錄」
4. 設定日期範圍
5. 點擊「Apply」

### 匯出檔案格式
- **格式**：Excel (.xlsx)
- **Sheet 1**：出缺勤紀錄
- **Sheet 2**：請假紀錄

### 匯出欄位
出缺勤紀錄：
- 員工編號、員工姓名、關聯編號、日期、簽到時間、簽退時間、簽到地點、簽退地點、工作時數

請假紀錄：
- 員工編號、員工姓名、關聯編號、請假日期、開始時間、結束時間、請假時數、請假原因

---

## 常見操作

### 新增一位新員工的完整流程

1. **建立員工帳號**
   - `員工` → `新增`
   - 填寫員工編號、姓名、Email、角色

2. **建立公司關係**
   - `員工與公司關係` → `新增`
   - 選擇員工、公司、設定入職日期

3. **指派主管**
   - `主管關係` → `新增`
   - 選擇員工與其直屬主管

4. **設定假別額度**
   - `假別額度` → `新增`
   - 為員工設定各假別的年度額度

5. **設定補打卡額度**
   - `補打卡額度` → `新增`
   - 設定年度補打卡次數

### 員工離職處理

1. **更新公司關係**
   - `員工與公司關係` → 找到該員工
   - 取消勾選「在職狀態」
   - 填入「離職日期」

2. **停用帳號**
   - `員工` → 找到該員工
   - 取消勾選「is_active」

3. **結束主管關係**
   - `主管關係` → 找到相關記錄
   - 填入「結束日期」

### 調整員工角色

1. 進入 `員工` 管理
2. 找到目標員工
3. 修改「角色」欄位
4. 儲存

### 批次設定假別額度

目前需逐筆新增，建議：
1. 匯出現有額度為 Excel
2. 修改後透過 Django Shell 批次匯入

---

## 權限控制

### 功能權限矩陣

| 功能 | 超級管理員 | HR | 主管 |
|------|:----------:|:--:|:----:|
| 員工管理 | ✓ | ✓ | ✗ |
| 公司管理 | ✓ | ✗ | ✗ |
| 部門管理 | ✓ | ✓ | ✗ |
| 主管關係 | ✓ | ✓ | ✗ |
| 審批政策 | ✓ | ✓ | ✗ |
| 假別額度 | ✓ | ✓ | ✗ |
| 出勤記錄 | ✓ | ✓ | ✓ |
| 請假記錄 | ✓ | ✓ | ✓ |
| 審批記錄 | ✓ | ✓ | ✓ |

### 設定後台登入權限

1. 進入 `員工` 管理
2. 編輯目標員工
3. 勾選 `is_staff`（允許登入後台）
4. 根據需要勾選 `is_superuser`（超級管理員）
5. 儲存

---

## 故障排除

### Q1: 無法登入後台？
**A:** 確認：
1. 帳號的 `is_staff` 是否為 True
2. 帳號的 `is_active` 是否為 True
3. 密碼是否正確

### Q2: 看不到某些管理項目？
**A:** 權限不足。需要超級管理員權限或特定角色權限。

### Q3: 審批後請假狀態沒更新？
**A:** 系統會在所有層級都核准後才更新。請確認是否還有其他待審批層級。

### Q4: 匯出 Excel 失敗？
**A:** 確認：
1. 伺服器已安裝 `openpyxl` 套件
2. 選擇的日期範圍有資料

---

*最後更新：2026-01-31*
