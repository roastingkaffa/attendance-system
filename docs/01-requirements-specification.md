# 需求規格書（Requirements Specification）
# 宏全出勤管理系統 v2.0

**文件版本**: 1.0
**建立日期**: 2025-11-19
**作者**: 系統架構團隊
**專案代號**: AMS-2.0

---

## 目錄
1. [執行摘要](#1-執行摘要)
2. [使用者角色定義](#2-使用者角色定義)
3. [功能需求清單](#3-功能需求清單)
4. [非功能需求](#4-非功能需求)
5. [業務規則](#5-業務規則)
6. [約束條件](#6-約束條件)

---

## 1. 執行摘要

### 1.1 專案背景
宏全出勤管理系統目前存在重大安全漏洞與架構問題：
- 業務邏輯在前端執行（時間產生、GPS 計算、工時計算）
- 敏感資料明文儲存（SECRET_KEY、密碼存 SessionStorage）
- 缺乏權限管理與審批流程
- 前端程式碼過於龐大（App.jsx 743 行）

### 1.2 專案目標
1. **安全性強化**：所有業務邏輯移至後端，消除前端可竄改風險
2. **架構重構**：前後端分離、模組化設計、可維護性提升
3. **功能完善**：新增審批流程、報表統計、異常處理、權限管理
4. **效能優化**：支援 1000+ 員工並發打卡，API 回應時間 < 200ms

### 1.3 範圍界定
**包含**：
- 核心功能重構（打卡、請假、審批）
- 安全性修復（認證、授權、資料加密）
- 新增功能（審批流程、報表、權限管理）
- 測試與文件

**不包含**：
- 薪資計算模組
- 排班管理
- 績效考核
- 移動應用程式（iOS/Android）

---

## 2. 使用者角色定義

### 2.1 角色概覽

| 角色 | 權限等級 | 主要職責 | 數量比例 |
|------|---------|---------|---------|
| 一般員工 (Employee) | L1 | 打卡、請假、查看個人記錄 | 80% |
| 部門主管 (Manager) | L2 | 審批請假、查看部門出勤、處理異常 | 15% |
| HR 管理員 (HR Admin) | L3 | 管理員工、公司設定、報表匯出 | 4% |
| 系統管理員 (System Admin) | L4 | 系統設定、權限管理、資料備份 | 1% |

### 2.2 詳細角色定義

#### 2.2.1 一般員工 (Employee)
**職責**：
- 使用 QR Code + GPS 進行上下班打卡
- 申請各類假別（病假、事假、特休等）
- 查看個人出勤記錄與請假記錄
- 接收系統通知（審批結果、異常提醒）
- 修改個人資料（密碼、聯絡方式）

**權限限制**：
- 僅能查看自己的資料
- 無法查看他人出勤狀況
- 無法修改已送出的請假申請

#### 2.2.2 部門主管 (Manager)
**職責**：
- 審批下屬的請假申請（一級審批）
- 查看部門出勤統計
- 處理異常打卡申請（補打卡、GPS 異常）
- 匯出部門月報表
- 接收異常通知（遲到、缺勤）

**權限範圍**：
- 可查看所屬部門員工的出勤資料
- 可審批指定額度內的請假（如 3 天以內）
- 無法修改員工的出勤記錄（僅能審批）

#### 2.2.3 HR 管理員 (HR Admin)
**職責**：
- 管理所有員工資料（新增、修改、離職）
- 管理公司資料（地點、GPS 座標、打卡範圍）
- 匯出全公司報表（月報、年報、統計分析）
- 處理複雜異常案例
- 管理假別設定與額度
- 二級審批（長假、特殊假別）

**權限範圍**：
- 可查看所有員工的出勤資料
- 可修改員工的基本資料
- 可調整打卡記錄（需留存稽核日誌）
- 無法刪除歷史記錄（僅能標記作廢）

#### 2.2.4 系統管理員 (System Admin)
**職責**：
- 系統設定與維護
- 權限管理（角色指派、權限調整）
- 資料備份與復原
- 系統監控與效能優化
- 稽核日誌查詢

**權限範圍**：
- 完整系統存取權限
- 可執行資料庫維護操作
- 可查看所有稽核日誌

---

## 3. 功能需求清單

### 3.1 優先級定義
- **P0 (Critical)**：系統核心功能，必須在 MVP 完成
- **P1 (High)**：重要功能，Phase 1 完成
- **P2 (Medium)**：次要功能，Phase 2 完成
- **P3 (Low)**：增強功能，可延後實作

### 3.2 認證與授權 (Authentication & Authorization)

#### [P0] US-001: 使用者登入
**使用者故事**：
As a **員工**,
I want **使用員工編號和密碼登入系統**,
So that **可以安全地存取我的出勤資料**。

**驗收標準**：
- [x] 支援員工編號 + 密碼登入
- [x] 登入失敗 3 次後鎖定帳號 15 分鐘
- [x] 密碼錯誤時不透露帳號是否存在
- [x] 成功登入後產生 Session，有效期 8 小時
- [x] 記錄登入日誌（時間、IP、裝置）

**技術規格**：
- API: `POST /api/v1/auth/login/`
- 認證方式：Session-based Authentication
- 密碼加密：PBKDF2-SHA256

---

#### [P0] US-002: 使用者登出
**使用者故事**：
As a **員工**,
I want **安全地登出系統**,
So that **其他人無法使用我的帳號**。

**驗收標準**：
- [x] 清除伺服器端 Session
- [x] 清除前端所有認證資料
- [x] 記錄登出日誌

**技術規格**：
- API: `POST /api/v1/auth/logout/`
- 自動登出：8 小時無操作自動登出

---

#### [P0] US-003: 修改密碼
**使用者故事**：
As a **員工**,
I want **修改我的登入密碼**,
So that **保護我的帳號安全**。

**驗收標準**：
- [x] 必須提供舊密碼驗證
- [x] 新密碼符合強度要求（8 字元以上、包含大小寫數字）
- [x] 修改成功後寄送 Email 通知
- [x] 修改後必須重新登入

**技術規格**：
- API: `POST /api/v1/auth/change-password/`
- 密碼強度驗證：Django Password Validators

---

#### [P1] US-004: 忘記密碼
**使用者故事**：
As a **員工**,
I want **使用 Email 重設密碼**,
So that **忘記密碼時可以恢復存取權限**。

**驗收標準**：
- [x] 輸入註冊 Email 發送重設連結
- [x] 重設連結有效期 1 小時
- [x] 連結僅能使用一次
- [x] 重設後舊密碼立即失效
- [x] 防止暴力枚舉（限制發送頻率）

**技術規格**：
- API: `POST /api/v1/auth/forgot-password/`
- Token: 使用 Django 內建 PasswordResetTokenGenerator

---

#### [P1] US-005: 角色權限管理
**使用者故事**：
As a **系統管理員**,
I want **管理使用者的角色和權限**,
So that **確保每個使用者只能存取授權的功能**。

**驗收標準**：
- [x] 支援 4 種預設角色（Employee, Manager, HR Admin, System Admin）
- [x] 可自訂角色與權限組合
- [x] 權限變更立即生效
- [x] 記錄權限變更稽核日誌

**技術規格**：
- API: `GET/POST/PATCH /api/v1/admin/roles/`
- 實作方式：Django Groups & Permissions

---

### 3.3 打卡功能 (Attendance)

#### [P0] US-006: 上班打卡（後端驗證）
**使用者故事**：
As a **員工**,
I want **掃描 QR Code 並由後端驗證我的位置**,
So that **打卡資料無法被前端竄改**。

**驗收標準**：
- [x] 前端傳送 QR Code 座標 + 使用者 GPS 座標
- [x] 後端驗證 QR Code 座標是否為有效公司地點
- [x] 後端計算距離，判斷是否在合法範圍內（依公司設定的 radius）
- [x] 後端產生打卡時間戳記（不使用前端時間）
- [x] 檢查當日是否已打卡（防止重複打卡）
- [x] 打卡成功後返回完整記錄（ID、時間、位置、距離）
- [x] 記錄打卡日誌（包含原始 GPS 座標）

**業務規則**：
- 距離計算：Haversine 公式
- 預設合法範圍：2000 公尺（可由 HR 管理員調整）
- 打卡時間精確到秒

**錯誤處理**：
- 距離超出範圍：返回實際距離，提示員工移動至正確位置
- 已打卡：返回今日打卡記錄
- GPS 無效：提示使用者檢查定位權限

**技術規格**：
```
POST /api/v1/attendance/clock-in/
Request:
{
  "qr_latitude": "25.0330",
  "qr_longitude": "121.5654",
  "user_latitude": "25.0335",
  "user_longitude": "121.5660"
}

Response (200 OK):
{
  "success": true,
  "message": "打卡成功",
  "data": {
    "id": 123,
    "date": "2025-11-19",
    "checkin_time": "2025-11-19T08:30:15",
    "checkin_location": "25.0335, 121.5660",
    "distance": 65.5,
    "company": "台北總公司"
  }
}

Response (400 Bad Request):
{
  "success": false,
  "error": {
    "code": "LOCATION_OUT_OF_RANGE",
    "message": "打卡位置超出範圍",
    "details": {
      "distance": 2500,
      "max_distance": 2000
    }
  }
}
```

---

#### [P0] US-007: 下班打卡
**使用者故事**：
As a **員工**,
I want **下班時打卡並由系統自動計算工時**,
So that **確保工時記錄準確**。

**驗收標準**：
- [x] 與上班打卡相同的位置驗證邏輯
- [x] 檢查當日是否有上班打卡記錄
- [x] 後端計算工時（下班時間 - 上班時間 - 午休時間）
- [x] 標記遲到/早退狀態
- [x] 計算加班時間（超過標準下班時間）

**業務規則**：
- 標準工時：08:30 - 17:00（8 小時，扣除 1 小時午休）
- 遲到定義：超過 08:30
- 早退定義：早於 17:00
- 加班計算：超過 17:30 開始計算

**技術規格**：
```
POST /api/v1/attendance/clock-out/
Request: 同 clock-in

Response (200 OK):
{
  "success": true,
  "message": "下班打卡成功",
  "data": {
    "id": 123,
    "date": "2025-11-19",
    "checkin_time": "2025-11-19T08:30:15",
    "checkout_time": "2025-11-19T18:00:30",
    "work_hours": 8.5,
    "overtime_hours": 0.5,
    "status": "normal",
    "flags": []
  }
}
```

---

#### [P1] US-008: 補打卡申請
**使用者故事**：
As a **員工**,
I want **申請補登忘記打卡的記錄**,
So that **避免缺勤扣薪**。

**驗收標準**：
- [x] 可申請補登上班或下班打卡
- [x] 需填寫補打卡原因
- [x] 需選擇補打卡時間
- [x] 送出後進入審批流程
- [x] 審批通過後自動補登記錄

**業務規則**：
- 補打卡僅限 3 天內
- 需主管審批
- 補登記錄標記為「補登」

**技術規格**：
- API: `POST /api/v1/attendance/makeup-request/`

---

#### [P2] US-009: GPS 異常處理
**使用者故事**：
As a **員工**,
I want **GPS 異常時可以手動申請打卡**,
So that **避免因技術問題無法打卡**。

**驗收標準**：
- [x] 偵測 GPS 異常（距離過遠、座標無效）
- [x] 提供手動申請打卡功能
- [x] 需上傳證明文件（照片、說明）
- [x] 進入人工審批流程

**技術規格**：
- API: `POST /api/v1/attendance/manual-clock-request/`

---

### 3.4 請假管理 (Leave Management)

#### [P0] US-010: 請假申請
**使用者故事**：
As a **員工**,
I want **申請各類假別並由系統自動計算時數**,
So that **方便管理我的假期**。

**驗收標準**：
- [x] 支援多種假別（病假、事假、特休、婚假、喪假等）
- [x] 可選擇整天/早上/下午
- [x] 可選擇日期範圍（連續請假）
- [x] 後端自動計算請假時數
- [x] 檢查假別額度（是否超過可請天數）
- [x] 送出後進入審批流程
- [x] 寄送通知給審批人員

**業務規則**：
- 整天請假：8 小時（扣除午休 1 小時）
- 早上請假：4 小時（08:30 - 12:30）
- 下午請假：4 小時（13:30 - 17:30）
- 連續請假需包含假日計算

**技術規格**：
```
POST /api/v1/leave/apply/
Request:
{
  "leave_type": "annual",
  "start_date": "2025-11-20",
  "end_date": "2025-11-22",
  "duration": "full_day",
  "reason": "家庭事務",
  "substitute_employee_id": "EMP002"  // 職務代理人（選填）
}

Response (201 Created):
{
  "success": true,
  "message": "請假申請已送出",
  "data": {
    "id": 456,
    "leave_hours": 24,
    "remaining_hours": 56,
    "approval_status": "pending",
    "approvers": ["MGR001", "HR001"]
  }
}

Response (400 Bad Request):
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_LEAVE_BALANCE",
    "message": "特休額度不足",
    "details": {
      "requested": 24,
      "available": 16
    }
  }
}
```

---

#### [P0] US-011: 查看請假記錄
**使用者故事**：
As a **員工**,
I want **查看我的請假歷史和審批狀態**,
So that **追蹤請假申請進度**。

**驗收標準**：
- [x] 顯示所有請假記錄（待審、已批准、已拒絕）
- [x] 顯示審批進度與審批人意見
- [x] 支援日期範圍篩選
- [x] 支援假別篩選
- [x] 顯示剩餘假別額度

**技術規格**：
- API: `GET /api/v1/leave/records/?status=pending&start_date=2025-11-01`

---

#### [P1] US-012: 撤銷請假申請
**使用者故事**：
As a **員工**,
I want **撤銷尚未審批的請假申請**,
So that **修正錯誤的申請內容**。

**驗收標準**：
- [x] 僅能撤銷「待審中」的申請
- [x] 已批准的申請需重新申請取消
- [x] 撤銷後通知審批人員
- [x] 記錄撤銷原因

**技術規格**：
- API: `POST /api/v1/leave/{id}/cancel/`

---

#### [P1] US-013: 請假審批（主管）
**使用者故事**：
As a **部門主管**,
I want **審批下屬的請假申請**,
So that **管理部門人力調度**。

**驗收標準**：
- [x] 顯示待審批的請假列表
- [x] 查看請假詳情（員工資訊、請假原因、日期）
- [x] 查看員工出勤歷史（協助判斷）
- [x] 可批准或拒絕請假
- [x] 拒絕時需填寫原因
- [x] 審批後自動通知員工

**業務規則**：
- 主管僅能審批直屬下屬
- 3 天以內直接批准，超過 3 天需 HR 覆核
- 審批時間限制：48 小時內需完成

**技術規格**：
```
POST /api/v1/leave/{id}/approve/
Request:
{
  "action": "approve",  // approve | reject
  "comment": "批准，請注意職務交接",
  "conditions": []  // 附加條件（選填）
}

Response (200 OK):
{
  "success": true,
  "message": "審批成功",
  "data": {
    "id": 456,
    "approval_status": "approved",
    "next_approver": null,
    "notification_sent": true
  }
}
```

---

#### [P2] US-014: 假別額度管理
**使用者故事**：
As a **HR 管理員**,
I want **設定與調整員工的假別額度**,
So that **確保假期管理符合公司政策**。

**驗收標準**：
- [x] 查看員工的各類假別額度
- [x] 調整額度（增加/減少）
- [x] 記錄調整原因與稽核日誌
- [x] 支援批次調整（如年度特休發放）

**技術規格**：
- API: `GET/PATCH /api/v1/admin/leave-balance/{employee_id}/`

---

### 3.5 報表與統計 (Reports & Analytics)

#### [P1] US-015: 個人出勤月報表
**使用者故事**：
As a **員工**,
I want **查看我的月出勤統計報表**,
So that **了解我的出勤狀況**。

**驗收標準**：
- [x] 顯示當月出勤天數、工時總計
- [x] 顯示遲到/早退次數
- [x] 顯示請假天數（依假別分類）
- [x] 顯示加班時數
- [x] 支援匯出 PDF/Excel

**技術規格**：
```
GET /api/v1/reports/personal/monthly?year=2025&month=11

Response:
{
  "employee_id": "EMP001",
  "employee_name": "張三",
  "year": 2025,
  "month": 11,
  "statistics": {
    "work_days": 20,
    "total_work_hours": 160,
    "total_overtime_hours": 10,
    "late_count": 2,
    "early_leave_count": 0,
    "absence_count": 0,
    "leave_breakdown": {
      "annual": 8,
      "sick": 4,
      "personal": 0
    }
  },
  "daily_records": [...]
}
```

---

#### [P1] US-016: 部門出勤報表（主管）
**使用者故事**：
As a **部門主管**,
I want **查看部門的出勤統計**,
So that **掌握部門人力狀況**。

**驗收標準**：
- [x] 顯示部門員工出勤總覽
- [x] 顯示異常統計（遲到、缺勤、異常打卡）
- [x] 支援日期範圍篩選
- [x] 支援匯出報表

**技術規格**：
- API: `GET /api/v1/reports/department/{dept_id}/`

---

#### [P1] US-017: 全公司出勤報表（HR）
**使用者故事**：
As a **HR 管理員**,
I want **匯出全公司的出勤報表**,
So that **進行薪資計算與統計分析**。

**驗收標準**：
- [x] 支援多種維度統計（部門、員工、日期）
- [x] 支援自訂欄位
- [x] 支援多種格式（Excel, CSV, PDF）
- [x] 支援排程匯出（每月自動產生）

**技術規格**：
- API: `POST /api/v1/reports/export/`

---

#### [P2] US-018: 出勤異常儀表板
**使用者故事**：
As a **HR 管理員**,
I want **查看即時出勤異常儀表板**,
So that **快速發現與處理異常狀況**。

**驗收標準**：
- [x] 即時顯示今日異常（遲到、缺勤、異常打卡）
- [x] 顯示待處理審批數量
- [x] 顯示趨勢圖表（週、月、年）
- [x] 支援異常預警（如缺勤率過高）

**技術規格**：
- API: `GET /api/v1/reports/dashboard/`

---

### 3.6 系統管理 (System Management)

#### [P1] US-019: 員工管理
**使用者故事**：
As a **HR 管理員**,
I want **管理員工基本資料**,
So that **維護員工檔案的正確性**。

**驗收標準**：
- [x] 新增員工（員工編號、姓名、部門、職位、入職日期）
- [x] 修改員工資料
- [x] 員工離職處理（不刪除記錄，僅標記離職）
- [x] 批次匯入員工（Excel/CSV）
- [x] 記錄所有變更稽核日誌

**技術規格**：
- API: `GET/POST/PATCH /api/v1/admin/employees/`

---

#### [P1] US-020: 公司地點管理
**使用者故事**：
As a **HR 管理員**,
I want **管理公司地點與打卡範圍**,
So that **支援多地點打卡**。

**驗收標準**：
- [x] 新增公司地點（名稱、地址、GPS 座標、打卡半徑）
- [x] 修改地點設定
- [x] 停用地點（不刪除）
- [x] 地圖介面顯示打卡範圍
- [x] 產生 QR Code

**技術規格**：
```
POST /api/v1/admin/companies/
Request:
{
  "name": "台北總公司",
  "address": "台北市信義區信義路五段7號",
  "latitude": "25.0330",
  "longitude": "121.5654",
  "radius": 2000,
  "is_active": true
}
```

---

#### [P2] US-021: 系統設定
**使用者故事**：
As a **系統管理員**,
I want **調整系統參數**,
So that **符合公司政策需求**。

**驗收標準**：
- [x] 工時設定（標準上下班時間、午休時間）
- [x] 遲到/早退定義
- [x] 打卡範圍預設值
- [x] Session 有效期限
- [x] 密碼強度規則
- [x] Email 通知設定

**技術規格**：
- API: `GET/PATCH /api/v1/admin/settings/`

---

#### [P1] US-022: 稽核日誌查詢
**使用者故事**：
As a **系統管理員**,
I want **查詢系統操作日誌**,
So that **追蹤異常行為與合規性檢查**。

**驗收標準**：
- [x] 記錄所有關鍵操作（登入、打卡、審批、資料修改）
- [x] 包含操作人、時間、IP、操作內容、結果
- [x] 支援多種篩選條件
- [x] 支援匯出
- [x] 日誌不可修改或刪除

**技術規格**：
- API: `GET /api/v1/admin/audit-logs/`

---

### 3.7 通知系統 (Notifications)

#### [P1] US-023: 系統通知
**使用者故事**：
As a **員工**,
I want **接收重要的系統通知**,
So that **即時了解審批結果與異常狀況**。

**驗收標準**：
- [x] 站內通知（未讀數量標記）
- [x] Email 通知（可設定開關）
- [x] 通知類型：
  - 請假審批結果
  - 補打卡審批結果
  - 異常提醒（遲到、缺勤）
  - 系統公告
- [x] 通知保留 30 天

**技術規格**：
- API: `GET /api/v1/notifications/`
- WebSocket: 即時推播（選配）

---

## 4. 非功能需求

### 4.1 效能需求 (Performance Requirements)

| 項目 | 指標 | 測試方法 |
|------|------|---------|
| API 回應時間 | P95 < 200ms | Apache Bench, Locust |
| 並發打卡能力 | 支援 500 人同時打卡 | 壓力測試 |
| 資料庫查詢 | 單一查詢 < 50ms | Django Debug Toolbar |
| 前端首屏載入 | < 2 秒 | Lighthouse |
| 報表匯出 | 1000 筆資料 < 5 秒 | 功能測試 |

### 4.2 安全性需求 (Security Requirements)

#### 4.2.1 認證與授權
- [x] 所有 API 需認證（除登入、忘記密碼）
- [x] 實作基於角色的存取控制 (RBAC)
- [x] Session 有效期 8 小時，閒置 30 分鐘自動登出
- [x] 密碼強度：最少 8 字元、包含大小寫字母與數字
- [x] 登入失敗 3 次鎖定 15 分鐘

#### 4.2.2 資料安全
- [x] 密碼使用 PBKDF2-SHA256 加密儲存
- [x] 敏感資料（如身分證字號）加密儲存
- [x] 傳輸層使用 HTTPS (TLS 1.3)
- [x] 環境變數管理敏感設定（不可明文在程式碼中）

#### 4.2.3 OWASP Top 10 防護
| 威脅 | 防護措施 |
|------|---------|
| Injection | ORM 參數化查詢、輸入驗證 |
| Broken Authentication | 強密碼策略、Session 管理、MFA（選配） |
| Sensitive Data Exposure | HTTPS、資料加密、最小權限原則 |
| XML External Entities | 禁用 XML 解析（使用 JSON） |
| Broken Access Control | RBAC、物件級權限檢查 |
| Security Misconfiguration | DEBUG=False、隱藏版本資訊、定期更新 |
| XSS | Content Security Policy、輸出編碼 |
| Insecure Deserialization | 避免反序列化不可信資料 |
| Using Components with Known Vulnerabilities | 定期更新依賴套件、使用 Safety 檢查 |
| Insufficient Logging & Monitoring | 完整稽核日誌、異常告警 |

#### 4.2.4 速率限制 (Rate Limiting)
| 端點 | 限制 |
|------|------|
| 登入 | 5 次/分鐘 |
| 忘記密碼 | 3 次/小時 |
| API（已認證） | 60 次/分鐘 |
| 報表匯出 | 10 次/小時 |

### 4.3 可用性需求 (Availability Requirements)

| 項目 | 指標 |
|------|------|
| 系統可用率 | 99.5%（每月停機時間 < 3.6 小時）|
| 計畫性維護 | 每月第一個週日凌晨 02:00-04:00 |
| 資料備份 | 每日全備份、每小時增量備份 |
| 災難復原時間 (RTO) | < 4 小時 |
| 資料復原點 (RPO) | < 1 小時 |

### 4.4 可擴展性需求 (Scalability Requirements)

| 項目 | 目標 |
|------|------|
| 使用者數量 | 支援 1000 員工 |
| 資料保留期限 | 出勤記錄保留 7 年 |
| 並發使用者 | 200 同時在線 |
| 資料庫容量 | 規劃 50GB（5 年資料） |
| 水平擴展 | 支援 Load Balancer + 多個 Application Server |

### 4.5 可維護性需求 (Maintainability Requirements)

- [x] 程式碼註解覆蓋率 > 20%
- [x] API 文件自動產生（OpenAPI/Swagger）
- [x] 測試覆蓋率 > 80%
- [x] 程式碼符合 PEP 8（Python）、ESLint（JavaScript）
- [x] 每個 Component/Function 單一職責
- [x] Git Commit 遵循 Conventional Commits

### 4.6 相容性需求 (Compatibility Requirements)

#### 瀏覽器支援
- Chrome 100+
- Firefox 100+
- Safari 15+
- Edge 100+
- 不支援 IE

#### 行動裝置
- iOS 14+ (Safari)
- Android 10+ (Chrome)
- 響應式設計（支援 320px - 1920px 寬度）

#### 伺服器環境
- Python 3.11+
- Django 5.1+
- MySQL 8.0+
- Node.js 20+ (前端建置)

---

## 5. 業務規則

### 5.1 工時計算規則
1. **標準工時**：08:30 - 17:00（實際工作 8 小時，扣除 1 小時午休）
2. **午休時間**：12:00 - 13:00（不計入工時）
3. **遲到定義**：上班時間晚於 08:30
4. **早退定義**：下班時間早於 17:00
5. **加班計算**：
   - 17:00 - 17:30：緩衝時間，不計加班
   - 17:30 之後：每滿 30 分鐘計 0.5 小時加班

### 5.2 請假規則
1. **特休假**：
   - 年資 < 1 年：0 天
   - 年資 1-2 年：7 天
   - 年資 3-5 年：10 天
   - 年資 5+ 年：15 天
2. **病假**：30 天/年（需醫生證明）
3. **事假**：14 天/年（無薪）
4. **婚假**：8 天（需結婚證書）
5. **喪假**：依親屬關係 3-8 天

### 5.3 審批規則
1. **請假審批流程**：
   - 1 天以內：部門主管審批
   - 2-3 天：部門主管 → HR 覆核
   - 4 天以上：部門主管 → HR → 總經理
2. **補打卡審批**：部門主管審批
3. **異常打卡審批**：HR 審批
4. **審批時限**：48 小時內需完成，逾期自動提醒

### 5.4 異常處理規則
1. **遲到**：
   - 5 分鐘內：不計異常
   - 5-30 分鐘：記警告
   - 30 分鐘以上：記缺勤 0.5 天
2. **忘記打卡**：
   - 3 天內可補打卡申請
   - 超過 3 天：記缺勤
3. **GPS 異常**：
   - 距離超過 3 倍合法範圍：自動拒絕
   - 距離超過合法範圍但在 3 倍內：可申請人工審批

---

## 6. 約束條件

### 6.1 技術約束
- 後端必須使用 Django 5.1+（團隊熟悉度）
- 前端必須使用 React 19+（既有技術棧）
- 資料庫必須使用 MySQL 8.0+（公司標準）
- 必須支援 AWS EC2 部署（既有環境）

### 6.2 時程約束
- MVP 版本：8 週內完成
- 完整版本：12 週內完成
- 必須在農曆年前上線（2025-01-15）

### 6.3 預算約束
- 開發人力：2 名全端工程師
- 測試人力：1 名 QA
- 伺服器成本：< $200 USD/月
- 第三方服務：< $100 USD/月

### 6.4 合規約束
- 符合台灣《個人資料保護法》
- 符合台灣《勞動基準法》工時規定
- 資料保留符合稅務法規（7 年）
- 稽核日誌不可竄改

### 6.5 人力約束
- 開發團隊：2 人（全端）
- 測試團隊：1 人（QA）
- 使用者接受度測試：10 人

---

## 附錄 A：術語表

| 術語 | 英文 | 定義 |
|------|------|------|
| 出勤記錄 | Attendance Record | 員工的上下班打卡記錄 |
| 請假記錄 | Leave Record | 員工的請假申請與審批記錄 |
| GPS 定位 | GPS Location | 使用衛星定位技術取得的地理座標 |
| QR Code | QR Code | 二維條碼，用於儲存公司地點座標 |
| 審批流程 | Approval Workflow | 請假或異常申請的多級審核流程 |
| Haversine 公式 | Haversine Formula | 計算地球表面兩點間距離的數學公式 |
| RBAC | Role-Based Access Control | 基於角色的存取控制 |
| Session | Session | 使用者登入後的會話狀態 |
| ORM | Object-Relational Mapping | 物件關聯對映 |

---

## 附錄 B：參考文件

1. Django 官方文件：https://docs.djangoproject.com/
2. React 官方文件：https://react.dev/
3. OWASP Top 10：https://owasp.org/www-project-top-ten/
4. RESTful API 設計指南：https://restfulapi.net/
5. 台灣個人資料保護法：https://law.moj.gov.tw/

---

**文件變更歷史**

| 版本 | 日期 | 作者 | 變更內容 |
|------|------|------|---------|
| 1.0 | 2025-11-19 | 系統架構團隊 | 初版建立 |
